let data={
    newsList:[
          { 
            title:'红星深度｜23只小熊猫之死：警方解救后寄养动物园 涉案野生动物救助待规范',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new1.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230515A09KKO00'
          },
          {
            title:'曾荣立一等战功的战区上将司令员发声，透露最新信号！',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new2.png',
            author:'政知见',
            url:'https://new.qq.com/rain/a/20230531A05OAE00'
          },
          {
            title:'山西10岁男孩失联身亡，嫌疑人系生母与继父 知情人：生母曾称是孩子偷钱挨打后跑了',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new3.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230524A041A700'
          },
          {
            title:'红星观察｜珠峰攀登生意经：有尊享版套餐，还有“被人抬着上山”一条龙服务',
            time:'2023-05-23',
            picPath:'/pages/homepage/images/new4.png',
            author:'红星深度',
            url:'https://new.qq.com/rain/a/20230523A0AGCH00'
          },{
            title:'武汉一小学生校园内被老师驾车碾死 校方：没酒驾，孩子跑到车前蹲着',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new5.png',
            author:'都市快报橙柿互动',
            url:'https://new.qq.com/rain/a/20230524A02J7R00'
          },{
            title:'今年会有多少新生儿？产科一线：过去一天分娩七八个，现在几天一个',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new6.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A01ASF00'
          },{
            title:'TikTok遭美国一州全面封杀！总裁周受资：违宪，已起诉',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new7.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A0422H00'
          },{
            title:'四川一教师输液时不幸身亡，涉事诊所称尽全力抢救，卫健局介入调查',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new8.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230523A05LTO00'
          },{
            title:'美国会众议长麦卡锡：我们向中国借钱，不是为了养美国这些闲人',
            time:'2023-05-21',
            picPath:'/pages/homepage/images/new9.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230526V08Z2A00'
          },{ 
            title:'塞尔维亚总统宣布27日辞去执政党主席职务，现场数十万人雨中集结',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new10.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230527A0297A00'
          },///////////
          {
            title:'美国研究首次系统性定义“长新冠”，12种“后遗症”症状列入',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new11.png',
            author:'第一财经',
            url:'https://new.qq.com/rain/a/20230526A04P8I00'
          },
          {
            title:'人均GDP吊打北上深，这些四线小城普遍“家里有矿、富得流油”',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new12.png',
            author:'国民经略',
            url:'https://new.qq.com/rain/a/20230527A02SW100'
          },
          {
            title:'9岁男孩失踪13年后尸骨现身山林地缝，两名村妇被警方带走',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new13.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230527V01VNY00'
          },{
            title:'男子称25元挂专家号，医生打20分钟电话聊拆迁：最后两句话打发我',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new14.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230526A09RGP00'
          },{
            title:'河北一派出所内烟花爆炸致4死2失联，4个月前当地曾发文禁止经营烟花',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new15.png',
            author:'上游新闻',
            url:'https://new.qq.com/rain/a/20230527V01RKQ00'
          },{
            title:'25岁研究生受伤后舍不得买贵支架，致血栓转移到肺部，逝世后捐献器官',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new16.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230527A01M7X00'
          },{
            title:'艰难开往乌克兰的F-16战机',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new17.png',
            author:'中国新闻周刊',
            url:'https://new.qq.com/rain/a/20230526A07XR400'
          },{
            title:'安徽女子死后被摘取器官案：被害人儿子涉嫌敲诈涉案医生被立案',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new18.png',
            author:'澎湃新闻',
            url:'https://new.qq.com/rain/a/20230528V03VA900'
          },
          { 
            title:'红星深度｜23只小熊猫之死：警方解救后寄养动物园 涉案野生动物救助待规范',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new1.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230515A09KKO00'
          },
          {
            title:'曾荣立一等战功的战区上将司令员发声，透露最新信号！',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new2.png',
            author:'政知见',
            url:'https://new.qq.com/rain/a/20230531A05OAE00'
          },
          {
            title:'山西10岁男孩失联身亡，嫌疑人系生母与继父 知情人：生母曾称是孩子偷钱挨打后跑了',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new3.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230524A041A700'
          },
          {
            title:'红星观察｜珠峰攀登生意经：有尊享版套餐，还有“被人抬着上山”一条龙服务',
            time:'2023-05-23',
            picPath:'/pages/homepage/images/new4.png',
            author:'红星深度',
            url:'https://new.qq.com/rain/a/20230523A0AGCH00'
          },{
            title:'武汉一小学生校园内被老师驾车碾死 校方：没酒驾，孩子跑到车前蹲着',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new5.png',
            author:'都市快报橙柿互动',
            url:'https://new.qq.com/rain/a/20230524A02J7R00'
          },{
            title:'今年会有多少新生儿？产科一线：过去一天分娩七八个，现在几天一个',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new6.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A01ASF00'
          },{
            title:'TikTok遭美国一州全面封杀！总裁周受资：违宪，已起诉',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new7.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A0422H00'
          },{
            title:'四川一教师输液时不幸身亡，涉事诊所称尽全力抢救，卫健局介入调查',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new8.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230523A05LTO00'
          },{
            title:'美国会众议长麦卡锡：我们向中国借钱，不是为了养美国这些闲人',
            time:'2023-05-21',
            picPath:'/pages/homepage/images/new9.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230526V08Z2A00'
          },{ 
            title:'塞尔维亚总统宣布27日辞去执政党主席职务，现场数十万人雨中集结',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new10.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230527A0297A00'
          },///////////
          {
            title:'美国研究首次系统性定义“长新冠”，12种“后遗症”症状列入',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new11.png',
            author:'第一财经',
            url:'https://new.qq.com/rain/a/20230526A04P8I00'
          },
          {
            title:'人均GDP吊打北上深，这些四线小城普遍“家里有矿、富得流油”',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new12.png',
            author:'国民经略',
            url:'https://new.qq.com/rain/a/20230527A02SW100'
          },
          {
            title:'9岁男孩失踪13年后尸骨现身山林地缝，两名村妇被警方带走',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new13.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230527V01VNY00'
          },{
            title:'男子称25元挂专家号，医生打20分钟电话聊拆迁：最后两句话打发我',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new14.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230526A09RGP00'
          },{
            title:'河北一派出所内烟花爆炸致4死2失联，4个月前当地曾发文禁止经营烟花',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new15.png',
            author:'上游新闻',
            url:'https://new.qq.com/rain/a/20230527V01RKQ00'
          },{
            title:'25岁研究生受伤后舍不得买贵支架，致血栓转移到肺部，逝世后捐献器官',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new16.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230527A01M7X00'
          },{
            title:'艰难开往乌克兰的F-16战机',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new17.png',
            author:'中国新闻周刊',
            url:'https://new.qq.com/rain/a/20230526A07XR400'
          },{
            title:'安徽女子死后被摘取器官案：被害人儿子涉嫌敲诈涉案医生被立案',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new18.png',
            author:'澎湃新闻',
            url:'https://new.qq.com/rain/a/20230528V03VA900'
          },
          { 
            title:'红星深度｜23只小熊猫之死：警方解救后寄养动物园 涉案野生动物救助待规范',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new1.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230515A09KKO00'
          },
          {
            title:'曾荣立一等战功的战区上将司令员发声，透露最新信号！',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new2.png',
            author:'政知见',
            url:'https://new.qq.com/rain/a/20230531A05OAE00'
          },
          {
            title:'山西10岁男孩失联身亡，嫌疑人系生母与继父 知情人：生母曾称是孩子偷钱挨打后跑了',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new3.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230524A041A700'
          },
          {
            title:'红星观察｜珠峰攀登生意经：有尊享版套餐，还有“被人抬着上山”一条龙服务',
            time:'2023-05-23',
            picPath:'/pages/homepage/images/new4.png',
            author:'红星深度',
            url:'https://new.qq.com/rain/a/20230523A0AGCH00'
          },{
            title:'武汉一小学生校园内被老师驾车碾死 校方：没酒驾，孩子跑到车前蹲着',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new5.png',
            author:'都市快报橙柿互动',
            url:'https://new.qq.com/rain/a/20230524A02J7R00'
          },{
            title:'今年会有多少新生儿？产科一线：过去一天分娩七八个，现在几天一个',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new6.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A01ASF00'
          },{
            title:'TikTok遭美国一州全面封杀！总裁周受资：违宪，已起诉',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new7.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A0422H00'
          },{
            title:'四川一教师输液时不幸身亡，涉事诊所称尽全力抢救，卫健局介入调查',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new8.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230523A05LTO00'
          },{
            title:'美国会众议长麦卡锡：我们向中国借钱，不是为了养美国这些闲人',
            time:'2023-05-21',
            picPath:'/pages/homepage/images/new9.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230526V08Z2A00'
          },{ 
            title:'塞尔维亚总统宣布27日辞去执政党主席职务，现场数十万人雨中集结',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new10.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230527A0297A00'
          },///////////
          {
            title:'美国研究首次系统性定义“长新冠”，12种“后遗症”症状列入',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new11.png',
            author:'第一财经',
            url:'https://new.qq.com/rain/a/20230526A04P8I00'
          },
          {
            title:'人均GDP吊打北上深，这些四线小城普遍“家里有矿、富得流油”',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new12.png',
            author:'国民经略',
            url:'https://new.qq.com/rain/a/20230527A02SW100'
          },
          {
            title:'9岁男孩失踪13年后尸骨现身山林地缝，两名村妇被警方带走',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new13.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230527V01VNY00'
          },{
            title:'男子称25元挂专家号，医生打20分钟电话聊拆迁：最后两句话打发我',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new14.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230526A09RGP00'
          },{
            title:'河北一派出所内烟花爆炸致4死2失联，4个月前当地曾发文禁止经营烟花',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new15.png',
            author:'上游新闻',
            url:'https://new.qq.com/rain/a/20230527V01RKQ00'
          },{
            title:'25岁研究生受伤后舍不得买贵支架，致血栓转移到肺部，逝世后捐献器官',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new16.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230527A01M7X00'
          },{
            title:'艰难开往乌克兰的F-16战机',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new17.png',
            author:'中国新闻周刊',
            url:'https://new.qq.com/rain/a/20230526A07XR400'
          },{
            title:'安徽女子死后被摘取器官案：被害人儿子涉嫌敲诈涉案医生被立案',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new18.png',
            author:'澎湃新闻',
            url:'https://new.qq.com/rain/a/20230528V03VA900'
          },
          { 
            title:'红星深度｜23只小熊猫之死：警方解救后寄养动物园 涉案野生动物救助待规范',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new1.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230515A09KKO00'
          },
          {
            title:'曾荣立一等战功的战区上将司令员发声，透露最新信号！',
            time:'2023-05-15',
            picPath:'/pages/homepage/images/new2.png',
            author:'政知见',
            url:'https://new.qq.com/rain/a/20230531A05OAE00'
          },
          {
            title:'山西10岁男孩失联身亡，嫌疑人系生母与继父 知情人：生母曾称是孩子偷钱挨打后跑了',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new3.png',
            author:'成都商报红星新闻',
            url:'https://new.qq.com/rain/a/20230524A041A700'
          },
          {
            title:'红星观察｜珠峰攀登生意经：有尊享版套餐，还有“被人抬着上山”一条龙服务',
            time:'2023-05-23',
            picPath:'/pages/homepage/images/new4.png',
            author:'红星深度',
            url:'https://new.qq.com/rain/a/20230523A0AGCH00'
          },{
            title:'武汉一小学生校园内被老师驾车碾死 校方：没酒驾，孩子跑到车前蹲着',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new5.png',
            author:'都市快报橙柿互动',
            url:'https://new.qq.com/rain/a/20230524A02J7R00'
          },{
            title:'今年会有多少新生儿？产科一线：过去一天分娩七八个，现在几天一个',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new6.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A01ASF00'
          },{
            title:'TikTok遭美国一州全面封杀！总裁周受资：违宪，已起诉',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new7.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A0422H00'
          },{
            title:'四川一教师输液时不幸身亡，涉事诊所称尽全力抢救，卫健局介入调查',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new8.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230523A05LTO00'
          },{
            title:'美国会众议长麦卡锡：我们向中国借钱，不是为了养美国这些闲人',
            time:'2023-05-21',
            picPath:'/pages/homepage/images/new9.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230526V08Z2A00'
          },{ 
            title:'塞尔维亚总统宣布27日辞去执政党主席职务，现场数十万人雨中集结',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new10.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230527A0297A00'
          },///////////
          {
            title:'美国研究首次系统性定义“长新冠”，12种“后遗症”症状列入',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new11.png',
            author:'第一财经',
            url:'https://new.qq.com/rain/a/20230526A04P8I00'
          },
          {
            title:'人均GDP吊打北上深，这些四线小城普遍“家里有矿、富得流油”',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new12.png',
            author:'国民经略',
            url:'https://new.qq.com/rain/a/20230527A02SW100'
          },
          {
            title:'9岁男孩失踪13年后尸骨现身山林地缝，两名村妇被警方带走',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new13.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230527V01VNY00'
          },{
            title:'男子称25元挂专家号，医生打20分钟电话聊拆迁：最后两句话打发我',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new14.png',
            author:'极目新闻',
            url:'https://new.qq.com/rain/a/20230526A09RGP00'
          },{
            title:'河北一派出所内烟花爆炸致4死2失联，4个月前当地曾发文禁止经营烟花',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new15.png',
            author:'上游新闻',
            url:'https://new.qq.com/rain/a/20230527V01RKQ00'
          },{
            title:'25岁研究生受伤后舍不得买贵支架，致血栓转移到肺部，逝世后捐献器官',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new16.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230527A01M7X00'
          },{
            title:'艰难开往乌克兰的F-16战机',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new17.png',
            author:'中国新闻周刊',
            url:'https://new.qq.com/rain/a/20230526A07XR400'
          },{
            title:'安徽女子死后被摘取器官案：被害人儿子涉嫌敲诈涉案医生被立案',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new18.png',
            author:'澎湃新闻',
            url:'https://new.qq.com/rain/a/20230528V03VA900'
          },{
            title:'红星观察｜珠峰攀登生意经：有尊享版套餐，还有“被人抬着上山”一条龙服务',
            time:'2023-05-23',
            picPath:'/pages/homepage/images/new4.png',
            author:'红星深度',
            url:'https://new.qq.com/rain/a/20230523A0AGCH00'
          },{
            title:'武汉一小学生校园内被老师驾车碾死 校方：没酒驾，孩子跑到车前蹲着',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new5.png',
            author:'都市快报橙柿互动',
            url:'https://new.qq.com/rain/a/20230524A02J7R00'
          },{
            title:'今年会有多少新生儿？产科一线：过去一天分娩七八个，现在几天一个',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new6.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A01ASF00'
          },{
            title:'TikTok遭美国一州全面封杀！总裁周受资：违宪，已起诉',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new7.png',
            author:'每日经济新闻',
            url:'https://new.qq.com/rain/a/20230524A0422H00'
          },{
            title:'四川一教师输液时不幸身亡，涉事诊所称尽全力抢救，卫健局介入调查',
            time:'2023-05-24',
            picPath:'/pages/homepage/images/new8.png',
            author:'九派新闻',
            url:'https://new.qq.com/rain/a/20230523A05LTO00'
          },{
            title:'美国会众议长麦卡锡：我们向中国借钱，不是为了养美国这些闲人',
            time:'2023-05-21',
            picPath:'/pages/homepage/images/new9.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230526V08Z2A00'
          },{ 
            title:'塞尔维亚总统宣布27日辞去执政党主席职务，现场数十万人雨中集结',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new10.png',
            author:'观察者网',
            url:'https://new.qq.com/rain/a/20230527A0297A00'
          },///////////
          {
            title:'美国研究首次系统性定义“长新冠”，12种“后遗症”症状列入',
            time:'2023-05-27',
            picPath:'/pages/homepage/images/new11.png',
            author:'第一财经',
            url:'https://new.qq.com/rain/a/20230526A04P8I00'
          }
    ],
    pageNum:1,
    pageSize:10,
    totalPage:1,
    favoritesList: [],
    favoritePageNum: 1,
    favoritePageSize: 10,
    favoriteTotalPage: 1
}

//链接数据库
const mysql = require('mysql');
const db = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: 'qewxs132',
  database: 'test'
});


const fs = require('fs');
const filePath = './data/comments.json';
const express = require('express')
const axios=require('axios');
const cheerio = require('cheerio');
const bodyParser = require('body-parser')
const app = express()
app.use(bodyParser.json())

//comment
const loadComments = () => {
  try {
      const data = fs.readFileSync(filePath, 'utf8');
      return JSON.parse(data);
  } catch (error) {
      // 如果文件不存在或读取失败，则返回空数组作为初始评论数据
      return [];
  }
};
// 保存评论数据
const saveComments = (comments) => {
  const cmtData = JSON.stringify(comments);
  fs.writeFileSync(filePath, cmtData, 'utf8');
};
function initialize(){
  cmtData = {
      cmtList: loadComments(),
  };
}
initialize()
app.use(bodyParser.json())

app.get('/api/comment', (req, res)=>{

  console.log('111:', cmtData); // 在控制台输出更新的评论数据
  res.json({cmtList:cmtData.cmtList});

})

app.post('/api/comment', (req, res) => {
  // 接收前端发送的评论数据更新请求
  const updatedCmtList = req.body.cmtList;
  if (updatedCmtList) {

      // 更新评论数据
      cmtData.cmtList = updatedCmtList;
      console.log('Received updatedCmtList:', updatedCmtList); // 在控制台输出更新的评论数据
      saveComments(cmtData.cmtList);
      // 返回更新成功的响应
      res.json({ message: '评论数据更新成功' });

  } else {
      // 请求中未包含有效的评论数据
      res.status(400).json({ error: '无效的请求数据' });
  }
});
//end-comment

async function fetchNewsContent(url) {
  try {
    const response = await axios.get(url);
    const htmlContent = response.data; // 网页内容的字符串

    const $ = cheerio.load(htmlContent);
    const articleContent = $('#ArticleContent'); // 选择包含新闻正文的元素

    // 提取 class="one-p" 的内容
    const onePElements = articleContent.find('.one-p');
    const newsContent = onePElements.map((index, element) => $(element).text()).get();
    // 返回新闻内容给前端
    return newsContent;
  } catch (error) {
    console.error('获取新闻内容失败:', error);
    throw error;
  }
}

// 设置路由，处理触底加载功能
app.get('/api/homepage/bottom', (req, res) => {
  const { pageNum } = req.query;
  const {bios}=req.query;
  const pageSize = 10;
  
  // 将 pageNum 转换为数字类型
  const pageNumber = parseInt(pageNum);
  const bios_=parseInt(bios);
  
  // 计算开始和结束索引
  const startIndex = (pageNumber * pageSize+bios_)%80;
  const endIndex = startIndex + pageSize;
  
  const new_pageNumber=Math.floor(startIndex/pageSize)+1;
  //调整结束地址
  if(endIndex>80){
    const endIndex1=80;
    const startIndex2=0;
    const endIndex2=endIndex%80;
    const newsData=data.newsList.slice(startIndex, endIndex1);
    const finalData=newsData.concat(data.newsList.slice(startIndex2, endIndex2));
    res.json({news:finalData,pageNum:new_pageNumber, bios:bios});
  }
  else{
    const newsData=data.newsList.slice(startIndex, endIndex);
    res.json({news:newsData,pageNum:new_pageNumber});
  }
});

// 设置路由， 处理加载界面功能
app.get('/api/homepage/load', (req, res)=>{
  console.log(data)
  const pageSize=10;
  const min=1;
  const max=data.newsList.length/pageSize;

  //生成页码和页内偏移量
  const pageNum=Math.floor(Math.random()*(max-min+1))+min;
  const bios=Math.floor(Math.random()*9);
  
  //计算起始地址和结束地址
  const startIndex=(pageNum-1)*pageSize+bios;
  const endIndex=startIndex+pageSize;
  if(endIndex>80){
    const endIndex1=80;
    const startIndex2=0;
    const endIndex2=endIndex%80;
    const newsData=data.newsList.slice(startIndex, endIndex1);
    const finalData=newsData.concat(data.newsList.slice(startIndex2, endIndex2));
    res.json({news:finalData,pageNum:pageNum, bios:bios});
  }
  else{
    const newsData=data.newsList.slice(startIndex, endIndex);
    res.json({news:newsData,pageNum:pageNum, bios:bios});
  }
})

//处理下拉刷新功能
app.get('/api/homepage/pull', (req, res)=>{
  const{pageNum}=req.query;
  const{bios}=req.query;
  const pageSize=10;

  const pageNumber=parseInt(pageNum);
  const bios_=parseInt(bios);

  //将pageNum加一，然后计算起始地址
  const startIndex=(pageNumber*pageSize+bios_)%80;
  const endIndex=startIndex+pageSize;
  const new_pageNumber=Math.floor(startIndex/pageSize)+1;
  //调整结束地址
  if(endIndex>80){
    const endIndex1=80;
    const startIndex2=0;
    const endIndex2=endIndex%80;
    const newsData=data.newsList.slice(startIndex, endIndex1);
    const finalData=newsData.concat(data.newsList.slice(startIndex2, endIndex2));
    res.json({news:finalData,pageNum:new_pageNumber, bios:bios});
  }
  else{
    const newsData=data.newsList.slice(startIndex, endIndex);
    res.json({news:newsData,pageNum:new_pageNumber});
  }
})

//获取新闻内容
app.post('/api/detail', async(req, res)=>{
  const{index, pageNum, bios}=req.body;
  const pageNumber=parseInt(pageNum);
  const ind=parseInt(index);
  const b=parseInt(bios);
  //得到具体新闻内容
  const newsIndex_1=(pageNumber-1)*10+b+ind;
  const newsIndex_2=newsIndex_1%80;
  var newsInfo=data.newsList[newsIndex_2];
  const newsContent=await fetchNewsContent(newsInfo.url);
  console.log(newsContent)
  //根据newsInfo中的新闻url链接获取对应链接的新闻正文内容
  res.json({news:newsInfo, content:newsContent});
})

//获取新闻内容
app.post('/api/detail/favorite', async(req, res)=>{
    //const{index, pageNum, bios}=req.body;
    const ind=parseInt(req.body.index);
    console.log(ind);
    const newsInfo = favoritesList[ind];
    const newsContent= await fetchNewsContent(newsInfo.url);
    res.json({news:newsInfo, content:newsContent});
})

// 设置路由， 处理加载界面功能
app.get('/api/favorite/load', (req, res)=>{
    fs.readFile('favorites.json', 'utf-8', function (err, data) {
        if (err) {
            console.log(err);
        } else {
            const pageNum =1;
            const bios =0;
            const parsedData = JSON.parse(data);
            const newsData= parsedData.favoritesList;
            const num = newsData.length;

            favoritesList = newsData;
            //console.log(favoritesList);
            res.json({news:newsData,pageNum:pageNum, bios:bios,num:num});
        }
    });
})

//获取新闻内容
app.post('/api/favorite/add', async(req, res)=>{
    console.log('add');
    fs.readFile('favorites.json', 'utf-8', function (err, data) {
        if (err) {
            console.log(err);
        } else {
            var favorList = JSON.parse(data);
            var newfavor={
                title:req.body.title,
                time:req.body.time,
                picPath:req.body.picPath,
                author:req.body.author,
                url:req.body.url,
            }
            //newfavor.record_id =(records.record.length + 1).toString();
            favorList.favoritesList.push(newfavor);
            console.log(favorList.favoritesList);
            fs.writeFile('favorites.json',JSON.stringify(favorList, null, 2), (error) => {
                if (error) {
                    console.log(error);
                }else{
                    console.log('Data written successfully to disk');
                }
            });
        }
    });
    //const{tit,tim,pic,au,u}=req.body;
    //const tit=JSON.parse(title);
    //const tim=JSON.parse(time);
    //const pic=JSON.parse(picPath);
    //const au=JSON.parse(author);
    //const u=JSON.parse(url);
    //data.favoritesList.append({'title':tit,'time':tim,'picPath':pic,'author':au,'url':u});
})

// 启动服务器
const port = 3000; // 设置服务器监听的端口号
app.listen(port, () => {
  console.log(`Server is running on port ${port}`);
});
